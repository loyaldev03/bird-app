<div class="feed-item">
  <p class="feed-posted"> 
    <%= time_ago_in_words(activity['updated_at'].in_time_zone) %> ago
  </p>

  <div class="t-wide">
    <%= link_to activity['activities'][0]['actor'] do %>
      <%= image_tag activity['activities'][0]['actor'].avatar.thumb.url, class: "feed-avatar" %>
      <strong><%= activity['activities'][0]['actor'].name %>:</strong>
    <% end %>

    <% if ["Release", "Announcement"].include? activity['activities'][0]['foreign_id'].class.to_s %>
      Added
    <% else %>
      Has
    <% end %>

    <% activity['activities'].reverse! %>
    <% if activity['activity_count'] > 1 %>
      <% for _activity in activity['activities'][0..-2] %>
        <%= render 'aggregated_activity/release_action', object: _activity %>
      <% end %>

      & <%= render 'aggregated_activity/release_action', object: activity['activities'][-1] %>

    <% else %>
      <%= render 'aggregated_activity/release_action', object: activity['activities'][0] %>
    <% end %>

    the <%= activity['activities'][0]['object'].class.to_s.downcase %>

    <strong>
      <%= activity['activities'][0]['object'].title %>
    </strong>


  </div>

    <% release =  activity['activities'][0]['object'] %>

    <div class="item-wide feed-release">
      <% if release.image_uri.present?
           image = release.image_uri
         else
           image = release.avatar.url
         end %>
      <%= link_to image_tag(image), release, class: "item-avatar" %>

      <div class="item-body">
        <h3>
          <%= link_to release.title.truncate(70).upcase, release %>
          <%= render 'likes/like_button', object: release %>
        </h3>

        <p>Release date: <%= time_ago_in_words( release.release_date ) %> ago</p>

        <p class="item-text"><%= strip_tags(release.text).truncate(220) %></p>

        <% if release.class.to_s == "Release" %>
          <%= link_to "LISTEN", get_release_tracks_path(release.id), 
              id: "play-release-#{release.id}",
              class: "btn c-btn-white c-btn-sm release-listen", remote: true %>

          <div class="jp-controls" style="display: none;">
            <div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
            <button class="jp-previous" role="button" tabindex="0"></button>
            <button class="jp-play jp-play-release" data-release="<%= release.id %>" role="button" tabindex="1"></button>
            <button class="jp-next" role="button" tabindex="2"></button>
            <div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
          </div>

          <% if release.download_uris.any? %>
            <a class="" type="button" data-toggle="collapse" data-target="#release-download<%= release.id %>" aria-expanded="false" aria-controls="collapseExample">
              <%= image_tag('icons/icon-download.svg', title: "Download full release", class: "icon-download") %>
            </a>

            <div id="release-download<%= release.id %>" class="collapse collapse-formats text-left" style="width: 241px; top: -20px;">
              <% release.download_uris.each do |format, uri| %>
                <a href="<%= uri %>" class="btn btn-danger"><%= format %></a>
              <% end %>
            </div>
          <% end %>
        <% end %>

        <button class="icon-share" type="button" data-toggle="collapse" data-target="#release<%= release.id %>-share" aria-expanded="false" aria-controls="collapseExample">
          <%= image_tag('icons/icon-share.svg', title: "Share") %>
        </button>

        <div id="release<%= release.id %>-share" class="collapse share-panel" style="bottom: 36px;">
          <h5 class="mx-3 my-2">Share</h5>
          <div class="mx-3 mb-3" data-object-type="release" data-object-id="<%= release.id %>">
            <%= social_share_button_tag(strip_tags(release.title).gsub("\'",''), desc: strip_tags(release.text).gsub("\'",''), image: image) %>
          </div>
        </div>

      </div>
    </div>


    
  <hr class="feed-divider">
</div>