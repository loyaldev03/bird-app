<div class="playlist-header">
  <% if @playlist.present? %>
    <%= link_to tracks_play_path(playlist_id: @playlist.id), remote: true do %>
      <%= image_tag 'icons/play-big.png' %>
    <% end %>
  <% end %>

  <%= render 'tracks/covers', object: tracks %>

  <% if @playlist.present? %>
    <div class="playlist-title">
      <%= @playlist.name %>
    </div>

    <div class="playlist-owner">
      <%= @playlist.user.name %>
    </div>
  <% end %>
</div>
<table class="playlist-items">
  <tr>
    <th></th>
    <th>Title</th>
    <th>Artist</th>
    <th>Release</th>
    <th class="text-center"><%= image_tag 'icons/time.png' %></th>
    <th>Rating</th>
    <th></th>
  </tr>
  <% for _track in tracks %>
    <% track = TrackPresenter.new(_track, current_user) %>
    <tr class='playlist-item'>
      <td>
        <%= link_to "", tracks_play_path(track_id: track.id), 
            class: "playlist-play-track-#{track.id}",
            remote: true %>
          <%#= image_tag 'icons/play-sm.png' %>
        <%# end %>
      </td>
      <td><%= track.title %></td>
      <td><%= track.artists %></td>
      <td>
        <%= link_to track.release.title, track.release, class: "release-link" %>
      </td>
      <td>Time</td>
      <td>
        <% unless current_user && current_user.has_role?(:artist) %>
          <%= rating_for track, 'main', star: 3, cancel: true, 
              disable_after_rate: false, star_path: '/images/rate/white' %>
          &nbsp;
        <% end %>
        <%= track.average('main').try(:avg).try(:round,1) %>
      </td>
      <td style="position: relative;">
        <% if track.user_allowed?(current_user) %>
          <button class="playlist-download-track" type="button" data-toggle="collapse" data-target="#download-<%= track.id %>" aria-expanded="false" aria-controls="collapseExample">
            <%= image_tag('icons/icon-download.png') %>
          </button>
        <% end %>
        <div id="download-<%= track.id %>" class="collapse collapse-formats">
            <% track.download_uris.each do |format, uri| %>
              <a href="<%= uri %>" class="btn btn-danger"><%= format %></a>
            <% end %>
        </div>

        <button class="playlist-add-track" data-track-id="<%= track.id %>">+</button>
      </td>
    </tr>
  <% end %>
</table>
