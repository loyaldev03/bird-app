<%= form_tag callbacks_braintree_nonce_path, id: "subscribe-form" do |f| %>

  <div class="form-group text-muted">
    <a href="https://www.braintreegateway.com/merchants/<%= ENV['BRAINTREE_MERCHANT_ID'] %>/verified" target="_blank">
      <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-light.png" width="280px" height ="44px" border="0"/>
    </a>
  </div>

  <div class="form-group" id="payment-form">
  </div>

  <% if !current_user.braintree_subscription %>
    <div class="form-group">
      <%= radio_button_tag(:subscription, 'monthly', checked: true) %>
      <%= label_tag(:subscription_monthly, 'Monthly - $6.99/month') %>
      <br>
      <%= radio_button_tag(:subscription, 'yearly') %>
      <%= label_tag(:subscription_yearly, 'Yearly - $75.00/year') %>
      <br>
      Both plans include a 30 day trial. You will not be billed if you cancel before it ends.
    </div>
  <% end %>

  <div class="form-group">
    <% if current_user.braintree_subscription %>
      <%= submit_tag 'Update Payment Method', class: 'btn btn-default' %>
    <% else %>
      <%= submit_tag 'Start Subscription', class: 'btn btn-default' %>
    <% end %>
  </div>
<% end %>

<script src="https://js.braintreegateway.com/js/braintree-2.21.0.min.js"></script>
<script>
  setTimeout(function(){
    // Honeybadger.wrap(function(){
      var clientToken = "<%= Braintree::ClientToken.generate %>";

      braintree.setup(clientToken, "dropin", {
        container: "payment-form",
        paypal: {
          button: {
            type: "checkout"
          }
        },
        onError: function(payload) {
          // Honeybadger.setContext({
          //   user_id: <%#= current_user ? current_user.id : 'none' %>,
          //   payload: payload
          // });

          // Honeybadger.notify({
          //   message: "Billing Form Incomplete",
          //   name: "BillingValidation"
          // });
        }
      });
    // })();
  },500);
</script>
