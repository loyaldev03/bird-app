<div class="feed-item">
  <%= link_to image_tag(user.avatar.thumb.url, class: "post-user-avatar"), 
      user, class: "post-owner" %>

  <div id="message-<%= comment.id %>"></div>

  <p class="feed-posted">Posted <%= time_ago_in_words(comment.created_at.in_time_zone) %> ago</p>

  <div class="feed-item-body">
    <div class="feed-name">
      <%= link_to user.name.split.map(&:capitalize).join(' '), user %>&nbsp;
    </div>

    <span class="float-right">
      <%= render 'comments/comment_controls', object: comment %>
    </span>
    
    <span id="feed-item-text-<%= comment.id %>">
      <%= comment_with_meta_data(comment.body).html_safe %>
    </span>


    <div>
      <% comment.feed_images.each do |image| %>
        <a href="<%= image.image.url %>" data-lightbox="image-<%=image.id%>">
          <%= image_tag image.image, class: "feed-image mb-2" %>
        </a>
      <% end %>
    </div>

    <div class="comment-footer">
      <span>
        <%= render partial: 'likes/like_button', locals: { object: comment,  style: 'thumbup' } %>
      </span>

      <div class="comment-footer-divider"></div>

      <span>
        Comment 
        (<span class="comments-count"><%= comment.try(:replies_count) %></span>)
      </span>
    </div>
  </div>

  <div id="comment-<%= comment.id %>-replies" class="<%= 'feed-replies' unless (!current_user && comment.replies.empty?) %>">

    <div class="feed-replies-list">
      <% if comment.replies.any? %>
        <%= (render partial: 'comments/comment', collection: comment.replies.order(created_at: :asc)) %>
      <% end %>
    </div>
    
    <% if comment.replies.count > 3 %>
      <a href="#" class="show-more-comments">View more comments (<%= comment.replies.count - 3 %>)</a>
    <% end %>

    <% if current_user %>
      <%= link_to "Reply", 
        comment_reply_form_path( 
          comment_id: comment.id, 
          commentable_id: comment.try(:commentable_id),
          commentable_type: comment.try(:commentable_type),
          comment_topic: comment.try(:topic_id) ), 
        remote: true, class: "btn c-btn-white btn-wide", id: "comment-reply-btn-#{comment.id}" %>
    <% end %>
  </div>

  <hr class="feed-divider">

</div>