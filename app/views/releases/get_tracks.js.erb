var tracks = [];
<% @release_presenter.tracks.each do |track| %>
  <% if track.artist_as_string && track.artist.present? %>
    <% artists = track.artist %>
  <% elsif track.users.any? %>
    <% track.users.each do |u| %>
      <% artists = track.users.map(&:name).join(' & ') %>
    <% end %>
  <% elsif track.artist.present? %>
    <% artists = track.artist %>
  <% else %>
    <% artists = 'Various Artists' %>
  <% end %>

  tracks.push({ 
    'release_id': '<%= @release_presenter.id %>',
    'track_number': '<%= track.track_number %>',
    'id': '<%= track.id %>',
    'title': '<%= track.title %>', 
    'artists': '<%= artists %>', 
    'mp3': '<%= track.stream_uri %>'
  });
<% end %>

if (tracks.length > 0) {
  setPlaylist(tracks, true);

  $("[id^='play-release-']").show().next('.jp-controls').css({'display': 'none'});
  $('#play-release-<%= @release_presenter.id %>').hide().next('.jp-controls').css({'display': 'inline-flex'});
}